FROM python:alpine3.7

LABEL maintainer "Hidetoshi Imai <hidepin@gmail.com>"

ARG MATTERMOST_INCOME_URL=http://xxx.xxx.xxx/hooks/xxxxxxxxxxxxxxxxxxxxx
ARG MATTERMOST_PRIVATE_INCOME_URL=http://xxx.xxx.xxx/hooks/xxxxxxxxxxxxxxxxxxxxx
ARG MATTERMOST_PRIVATE_PROJECT=xxx
ARG MATTERMOST_USERNAME=subot
ARG MATTERMOST_ADDRESS=127.0.0.1
ARG MATTERMOST_LOGIN_ID=admin
ARG MATTERMOST_PASSWORD=admin
ARG MATTERMOST_PORT=80
ARG MATTERMOST_EXCLUDE_NOTIFICATE=
ARG MATTERMOST_MESSAGE_MAX=1000

ENV PYTHONUNBUFFERED=1 \
    MATTERMOST_INCOME_URL=${MATTERMOST_INCOME_URL} \
    MATTERMOST_PRIVATE_INCOME_URL=${MATTERMOST_PRIVATE_INCOME_URL}
    MATTERMOST_PRIVATE_PROJECT=${MATTERMOST_PRIVATE_PROJECT}
    MATTERMOST_USERNAME=${MATTERMOST_USERNAME} \
    MATTERMOST_ADDRESS=${MATTERMOST_ADDRESS} \
    MATTERMOST_LOGIN_ID=${MATTERMOST_LOGIN_ID} \
    MATTERMOST_PASSWORD=${MATTERMOST_PASSWORD} \
    MATTERMOST_PORT=${MATTERMOST_PORT} \
    MATTERMOST_EXCLUDE_NOTIFICATE=${MATTERMOST_EXCLUDE_NOTIFICATE} \
    MATTERMOST_MESSAGE_MAX=${MATTERMOST_MESSAGE_MAX}

RUN pip install mattermostdriver

COPY files/smtp2mattermost.py /usr/local/bin/smtp2mattermost.py

CMD ["/usr/local/bin/smtp2mattermost.py"]
